<!DOCTYPE html>
<html lang="pt">
<head>
  <meta charset="UTF-8">
  <title>Envio Direto de E-mails – Scrivi Italia</title>
  <link rel="stylesheet" href="style.css">
</head>
<body>

  <!-- Header -->
  <div id="header"></div>

  <main class="container">

    <h1>Envio Direto de E-mails</h1>
    <p>
      ⚠️ Esta ferramenta permite o envio de e-mails diretamente aos parlamentares italianos usando seu cliente de e-mail.
      Os endereços são inseridos automaticamente no campo <strong>Cco</strong> (com cópia oculta), garantindo privacidade no envio.
    </p>
    <p>
      ⚠️ Use a tecla TAB para navegar pelos campos do cliente de e-mail.
    </p>
    <p>
      ⚠️ Não esqueça de colocar o seum nome no final da mensagem.
    </p>
    <p>
      Um título e uma mensagem são selecionados automaticamente, mas você pode
      <a href="modelos.html">escolher outro modelo</a> ou
      <a href="senadores.html">selecionar senadores individualmente</a> e
      <a href="deputados.html">deputados individualmente</a>.
    </p>

    <h2>Senadores</h2>
    <div id="btn-senadores" class="pagination"></div>
    
    <h2>Deputados</h2>
    <div id="btn-deputados" class="pagination"></div>

  </main>

  <!-- Footer -->
  <div id="footer"></div>

<script>
  const titulos = [
    "Difendiamo la cittadinanza italiana per discendenza",
    "Appello contro il Decreto-Legge 36/2025",
    "Tutela dei diritti dei cittadini italo-discendenti",
    "Preservare l’identità italiana oltre i confini",
    "No alla stretta sulla cittadinanza agli italiani all’estero"
  ];

  async function sortearMensagem() {
    const res = await fetch('mensagens.json');
    const mensagens = await res.json();

    // Se for array (várias mensagens)
    if (Array.isArray(mensagens)) {
      const escolhida = mensagens[Math.floor(Math.random() * mensagens.length)];
      return escolhida.it;
    }

    // Se for objeto com .it fixo
    return mensagens.it;
  }

  async function gerarBotoesEmail(tipo, containerId) {
    try {
      const res = await fetch(`${tipo}.json`);
      const parlamentares = await res.json();
      const mensagensRes = await fetch('mensagens.json');
      const mensagens = await mensagensRes.json();
      
      const emails = parlamentares.map(p => p.email);
      const partes = Math.ceil(emails.length / 135);
      const container = document.getElementById(containerId);
      container.innerHTML = ''; // limpar antes

      for (let i = 0; i < partes; i++) {
        const grupo = emails.slice(i * 135, (i + 1) * 135).join(',');
        const titulo = encodeURIComponent(titulos[Math.floor(Math.random() * titulos.length)]);
        const corpo = encodeURIComponent(
          Array.isArray(mensagens) 
            ? mensagens[Math.floor(Math.random() * mensagens.length)].it
            : mensagens.it
        );
        const mailto = `mailto:?bcc=${grupo}&subject=${titulo}&body=${corpo}`;

        const btn = document.createElement('a');
        btn.href = mailto;
        btn.innerHTML = `<button>Enviar e-mail ${i + 1} de ${partes}</button>`;
        container.appendChild(btn);
      }
    } catch (error) {
      console.error("Erro ao gerar botões de email:", error);
    }
  }

  document.addEventListener('DOMContentLoaded', () => {
    // Carrega header e footer
    fetch('header.html')
      .then(res => res.text())
      .then(data => document.getElementById('header').innerHTML = data);
    fetch('footer.html')
      .then(res => res.text())
      .then(data => document.getElementById('footer').innerHTML = data);

    // Gera os botões dinamicamente
    gerarBotoesEmail('senadores_italianos', 'btn-senadores');
    gerarBotoesEmail('deputados_italianos', 'btn-deputados');
  });
</script>


</body>
</html>
