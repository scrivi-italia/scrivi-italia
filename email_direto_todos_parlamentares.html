<!DOCTYPE html>
<html lang="pt">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Email Direto | Scrivi Italia</title>
  <link rel="stylesheet" href="style.css" />
</head>
<body>
  <div id="header-placeholder"></div>

  <main class="container">
    <h1>Email Direto aos Parlamentares</h1>
    <p>Envie um e-mail com cópia oculta (Cco/Bcc) para os parlamentares listados abaixo.</p>
    
    <div id="tabela-parlamentares"></div>
    <p id="page-indicator" style="text-align: center; margin-top: 1rem;"></p>

    <div class="pagination-fixed">
      <button onclick="previousPage()">Anterior</button>
      <button onclick="copiarEmailsPagina()">Copiar emails</button>
      <button onclick="enviarEmailPagina()">Enviar email</button>
      <button onclick="nextPage()">Próxima</button>
    </div>
  </main>

  <div id="footer-placeholder"></div>

  <!-- Modal -->
  <div id="emailModal" class="modal">
    <div class="modal-content">
      <span class="close-button" onclick="fecharModal()">&times;</span>
      <h2>📋 Emails copiados!</h2>        
      <p id="modalText"></p>   
      <p>✉️ Cole no campo <strong>Cco ou Bcc</strong> do seu programa de email (Gmail, Outlook...)</p>
      <div style="background: #f4f4f4; border-left: 4px solid #cc0000; padding: 0.8rem; border-radius: 8px; margin: 1rem 0;">
        <p style="margin: 0;"><strong>Por que usar o campo Cco/Bcc?</strong></p>
        <ul style="padding-left: 1.2rem; margin: 0;">
          <li>🔒 Privacidade entre os destinatários</li>
          <li>📬 Menor chance de cair no spam</li>         
        </ul>
      </div>
    </div>
  </div>

  <script>
    let parlamentares = [];
    let currentPage = 1;
    const itemsPerPage = 100;

    document.addEventListener("DOMContentLoaded", () => {
      fetch("header.html")
        .then(res => res.text())
        .then(data => document.getElementById("header-placeholder").innerHTML = data);

      fetch("footer.html")
        .then(res => res.text())
        .then(data => document.getElementById("footer-placeholder").innerHTML = data);

      fetch("todos_parlamentares.json?nocache=" + new Date().getTime())
        .then(res => res.json())
        .then(data => {
          parlamentares = data;
          renderPage();
        })
        .catch(() => {
          document.getElementById("tabela-parlamentares").innerText = "Erro ao carregar dados.";
        });
    });

    function renderPage() {
      const start = (currentPage - 1) * itemsPerPage;
      const end = start + itemsPerPage;
      const pageData = parlamentares.slice(start, end);
      const totalPages = Math.ceil(parlamentares.length / itemsPerPage);

      let html = '<table><thead><tr><th>Nome</th><th>Câmara</th><th>Partido</th><th>Email</th></tr></thead><tbody>';
      pageData.forEach(p => {
        const emailLink = p.email ? `<a href="mailto:${p.email}">${p.email}</a>` : "";
        html += `<tr><td>${p.nome}</td><td>${p.casa}</td><td>${p.partido}</td><td>${emailLink}</td></tr>`;
      });
      html += '</tbody></table>';

      document.getElementById("tabela-parlamentares").innerHTML = html;
      document.getElementById("page-indicator").innerText = `Página ${currentPage} de ${totalPages}`;
    }

    function nextPage() {
      if (currentPage < Math.ceil(parlamentares.length / itemsPerPage)) {
        currentPage++;
        renderPage();
      }
    }

    function previousPage() {
      if (currentPage > 1) {
        currentPage--;
        renderPage();
      }
    }

    function copiarEmailsPagina() {
      const emails = getEmailsPagina();
      if (emails) {
        navigator.clipboard.writeText(emails.join(", ")).then(() => {
          document.getElementById("modalText").innerHTML = `<strong>${emails.length}</strong> emails copiados com sucesso.`;
          document.getElementById("emailModal").style.display = "block";
        });
      }
    }

    function enviarEmailPagina() {
      const emails = getEmailsPagina();
      if (emails.length === 0) return;
      const mailtoLink = `mailto:?bcc=${encodeURIComponent(emails.join(","))}`;
      window.location.href = mailtoLink;
    }

    function getEmailsPagina() {
      const start = (currentPage - 1) * itemsPerPage;
      const end = start + itemsPerPage;
      const pageData = parlamentares.slice(start, end);
      return pageData
        .filter(p => p.email)
        .map(p => p.email);
    }

    function fecharModal() {
      document.getElementById("emailModal").style.display = "none";
    }
  </script>
</body>
</html>
